<!DOCTYPE html>
<html dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="./css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <link rel="stylesheet" href="./css/Login form.css">
    <title>Document</title>
</head>
<body>
    <div class="container">
        <div class="login-content">
            <div class="login-content-out">
                <div class="form-container">
                    <img class="background-image" src="./img/analog-landscape-city-with-buildings.png">
                    
                       
            
                        <form class="form" id="login-form">
                            
                  
                            <h2 class="login-form">تسجيل دخول</h2>
                            <div class="flex-column">
                              <label>الايميل او رقم الهاتف  </label></div>
                              
                              <input class="inputForm" type="text" id="email" required>

                              <input class="inputForm" type="text" id="phone" placeholder="Phone Number" required>
                               
                              
                            
                            <div class="flex-column">
                              <label>كلمة المرور  </label></div>
                              <input class="inputForm" type="password" id="password" required>
                            
                             <button class="button-submit" type="submit">تسجيل الدخول</button>  
                            <div class="flex-row">
                                <p class="p">ليس لديك حساب؟ <span class="span"><a href="./signup.html">انشاء حساب</a></span>
                                    <span class="span" style="color: #161D6F;">نسيت كملة السر</span>
                        
                        
                              </div>
                           
                            </p>
                            <div class="or-line">أو</div>
                        
                            <div class="flex-row">
                                <button class="btn facebook" id="btn-facebook">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20">
                                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm2.44 7.89h-1.39c-.12 0-.22.1-.22.22v1.31h1.6v1.59h-1.6v4.85h-1.92v-4.85H9.78v-1.59h1.59V9.57c0-1.02.78-1.95 1.83-1.95h1.63v1.27h-1.18c-.27 0-.49.22-.49.49v1.16h1.68L13.44 12z" fill="#1877f2"/>
                                    </svg>
                                        <g> 
                                            <g> 
                                                <path d="M11.387,0c-6.313,0-11.46,5.147-11.46,11.46c0,6.314,5.147,11.461,11.46,11.461c6.313,0,11.461-5.147,11.461-11.461 C22.847,5.147,17.7,0,11.387,0z M13.469,7.751h-1.497c-0.441,0-0.797,0.357-0.797,0.798v1.389h2.295c0.219,0,0.395,0.178,0.395,0.397 v1.897c0,0.219-0.178,0.396-0.395,0.396h-2.295v5.106c0,0.22-0.178,0.398-0.398,0.398h-2.25c-0.22,0-0.397-0.178-0.397-0.398v-5.106 H7.48v-1.897h1.279c0.271,0,0.514-0.126,0.675-0.329c0.158-0.204,0.229-0.474,0.191-0.75c-0.044-0.297-0.187-0.551-0.416-0.756 c-0.237-0.21-0.533-0.318-0.876-0.318H7.48c-0.568,0-0.998-0.45-0.998-1.018V7.098c0-0.569,0.43-1.018,0.998-1.018h1.967 c0.413,0,0.774,0.185,1.055,0.497c0.28,0.31,0.439,0.717,0.439,1.175v0.436H11.4l-0.2,0.19l-0.214,0.202h-1.033v1.964h1.34 c0.213,0,0.397,0.183,0.397,0.398v5.106c0,0.22-0.184,0.398-0.397,0.398h-1.79c-0.218,0-0.396-0.178-0.396-0.398v-5.106H8.144 V9.707h0.862c0.205,0,0.396,0.1,0.518,0.26c0.118,0.161,0.167,0.366,0.132,0.574c-0.026,0.168-0.113,0.329-0.256,0.472 c-0.142,0.143-0.303,0.232-0.471,0.257c-0.177,0.032-0.355-0.022-0.5-0.144c-0.139-0.122-0.233-0.304-0.26-0.495 c-0.047-0.396,0.035-0.782,0.23-1.095c0.199-0.316,0.481-0.566,0.835-0.741c0.35-0.178,0.73-0.273,1.127-0.273h0.825 c0.569,0,1.018,0.45,1.018,1.018v1.881c0,0.568-0.449,1.018-1.018,1.018H12.66v1.964h1.856c0.219,0,0.398,0.178,0.398,0.398v1.896 c0,0.219-0.179,0.396-0.398,0.396h-1.856v3.925c0,0.319-0.194,0.48-0.441,0.48c-0.246,0-0.407-0.161-0.441-0.48v-3.925h-0.899 c-0.219,0-0.396-0.178-0.396-0.396v-1.896c0-0.22,0.177-0.398,0.396-0.398h0.899V9.707h-0.899c-0.219,0-0.396-0.178-0.396-0.398 V7.754c0-0.22,0.177-0.397,0.396-0.397h0.899v-0.771C12.864,7.939,13.118,7.751,13.469,7.751z"></path> 
                                            </g>
                                        </g>
                                    </svg>
                                    
                                    Facebook
                                </button>
                            
                              <button class="btn apple" id="btn-apple">
                        <svg xml:space="preserve" style="enable-background:new 0 0 22.773 22.773;" viewBox="0 0 22.773 22.773" y="0px" x="0px" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" id="Capa_1" width="20" height="20" version="1.1"> <g> <g> <path d="M15.769,0c0.053,0,0.106,0,0.162,0c0.13,1.606-0.483,2.806-1.228,3.675c-0.731,0.863-1.732,1.7-3.351,1.573 c-0.108-1.583,0.506-2.694,1.25-3.561C13.292,0.879,14.557,0.16,15.769,0z"></path> <path d="M20.67,16.716c0,0.016,0,0.03,0,0.045c-0.455,1.378-1.104,2.559-1.896,3.655c-0.723,0.995-1.609,2.334-3.191,2.334 c-1.367,0-2.275-0.879-3.676-0.903c-1.482-0.024-2.297,0.735-3.652,0.926c-0.155,0-0.31,0-0.462,0 c-0.995-0.144-1.798-0.932-2.383-1.642c-1.725-2.098-3.058-4.808-3.306-8.276c0-0.34,0-0.679,0-1.019 c0.105-2.482,1.311-4.5,2.914-5.478c0.846-0.52,2.009-0.963,3.304-0.765c0.555,0.086,1.122,0.276,1.619,0.464 c0.471,0.181,1.06,0.502,1.618,0.485c0.378-0.011,0.754-0.208,1.135-0.347c1.116-0.403,2.21-0.865,3.652-0.648 c1.733,0.262,2.963,1.032,3.723,2.22c-1.466,0.933-2.625,2.339-2.427,4.74C17.818,14.688,19.086,15.964,20.67,16.716z"></path> </g></g></svg>
                        
                                Apple 
                                
                        </button>
                        <button class="btn google" id="btn-google">
                            <svg xml:space="preserve" style="enable-background:new 0 0 512 512;" viewBox="0 0 512 512" y="0px" x="0px" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" id="Layer_1" width="20" version="1.1">
                    <path d="M113.47,309.408L95.648,375.94l-65.139,1.378C11.042,341.211,0,299.9,0,256
                        c0-42.451,10.324-82.483,28.624-117.732h0.014l57.992,10.632l25.404,57.644c-5.317,15.501-8.215,32.141-8.215,49.456
                        C103.821,274.792,107.225,292.797,113.47,309.408z" style="fill:#FBBB00;"></path>
                    <path d="M507.527,208.176C510.467,223.662,512,239.655,512,256c0,18.328-1.927,36.206-5.598,53.451
                        c-12.462,58.683-45.025,109.925-90.134,146.187l-0.014-0.014l-73.044-3.727l-10.338-64.535
                        c29.932-17.554,53.324-45.025,65.646-77.911h-136.89V208.176h138.887L507.527,208.176L507.527,208.176z" style="fill:#518EF8;"></path>
                    <path d="M416.253,455.624l0.014,0.014C372.396,490.901,316.666,512,256,512
                        c-97.491,0-182.252-54.491-225.491-134.681l82.961-67.91c21.619,57.698,77.278,98.771,142.53,98.771
                        c28.047,0,54.323-7.582,76.87-20.818L416.253,455.624z" style="fill:#28B446;"></path>
                    <path d="M419.404,58.936l-82.933,67.896c-23.335-14.586-50.919-23.012-80.471-23.012
                        c-66.729,0-123.429,42.957-143.965,102.724l-83.397-68.276h-0.014C71.23,56.123,157.06,0,256,0
                        C318.115,0,375.068,22.126,419.404,58.936z" style="fill:#F14336;"></path>
                    
                    </svg>
                       
                            Google 
                            
                          </button>
                        
                    
                    </div>
                    </form>
                          
                    
                        
                   
                </div>
            </div>
            </div>
            
            <div id="message"></div>
    </div>
    
    <script>

// const createAccountLink = document.querySelector('.span a');


// createAccountLink.addEventListener('click', function(event) {
   
//     event.preventDefault();

//     // Apply animation to login page content
//     const loginContent = document.querySelector('.login-content');
//     loginContent.classList.add('slide-out');
//     setTimeout(function() {
//         window.location.href = './signup.html';
//     }, 1000); 
// });

// ...................................................................
// Function to handle login form submission
document.getElementById('login-form').addEventListener('submit', async function(event) {
    event.preventDefault();

    const email = document.getElementById('email').value;
    const phone = document.getElementById('phone').value;
    const password = document.getElementById('password').value;

    const formData = new FormData();
    formData.append('email', email);
    formData.append('phone_number', phone);
    formData.append('password', password);

    for (const pair of formData.entries()) {
        console.log(`${pair[0]}: ${pair[1]}`);
    }

    try {
        const response = await fetch('https://task5-riham-esmail.trainees-mad-s.com/api/auth/login', {
            method: 'POST',
            body: formData,
            headers: {
                'Accept': 'application/json',
            },
        });

        const data = await response.json();
        console.log('API response:', data);

        if (response.status === 200 || response.status === 201) {
            localStorage.setItem('isLoggedIn', 'true');
            localStorage.setItem('accessToken', data.data.accessToken);
            localStorage.setItem('username', data.data.username); // Store username

            Swal.fire({
                icon: 'success',
                title: 'تم تسجيل الدخول',
                text: 'تم تسجيل الدخول بنجاح.',
            }).then(() => {
                console.log('Direction to the home page');
                window.location.href = 'index.html';
            });
        } else if (response.status === 401) {
            Swal.fire({
                icon: 'error',
                title: 'يجب تأكيد الحساب',
                text: 'يرجى تأكيد حسابك قبل تسجيل الدخول.',
            });
            console.error('Error 401: Account confirmation required. Response data:', data);
        } else {
            Swal.fire({
                icon: 'error',
                title: 'خطأ في تسجيل الدخول',
                text: data.message || 'حدث خطأ غير متوقع. يرجى المحاولة مرة أخرى.',
            });
            console.error('Unexpected error. Response status:', response.status, 'Response data:', data);
        }
    } catch (error) {
        Swal.fire({
            icon: 'error',
            title: 'حدث خطا غير متوقع',
            text: 'حدث خطأ غير متوقع. يرجى المحاولة مرة أخرى.',
        });
        console.error('Unexpected error:', error);
    }
});

// Function to handle DOMContentLoaded event
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOMContentLoaded started');
    const loginButton = document.getElementById('loginButton');
    const isLoggedIn = localStorage.getItem('isLoggedIn');
    const username = localStorage.getItem('username'); // Get username from localStorage
    console.log('DOMContentLoaded - isLoggedIn:', isLoggedIn);

    if (isLoggedIn === 'true') {
        loginButton.textContent = `تسجيل خروج (${username})`; // Display username next to the button text
        console.log('DOMContentLoaded - User is logged in, setting logout button');

        loginButton.addEventListener('click', async function() {
            console.log('Logout button clicked');

            // Show confirmation modal
            const confirmationModal = document.getElementById('confirmationModal');
            confirmationModal.style.display = 'block';

            document.getElementById('confirmLogout').addEventListener('click', async function() {
                confirmationModal.style.display = 'none';

                const url = 'https://task5-riham-esmail.trainees-mad-s.com/api/auth/logout';
                const accessToken = localStorage.getItem('accessToken');
                console.log('Logout - accessToken:', accessToken);

                try {
                    const response = await fetch(url, {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json',
                            'Authorization': `Bearer ${accessToken}`
                        },
                    });

                    console.log('Logout - HTTP status:', response.status);

                    if (response.status === 200) {
                        const data = await response.json();
                        console.log('Logout - API response:', data);

                        Swal.fire({
                            icon: 'success',
                            title: 'تم تسجيل الخروج',
                            text: 'تم تسجيل الخروج بنجاح.',
                        }).then((result) => {
                            if (result.isConfirmed) {
                                console.log('Logout successful');
                                localStorage.removeItem('isLoggedIn');
                                localStorage.removeItem('accessToken');
                                localStorage.removeItem('username'); // Remove username from localStorage
                                window.location.href = 'login.html';
                            }
                        });
                    } else {
                        const errorData = await response.json();
                        console.error('Logout - Failed to logout:', response.status, 'Response data:', errorData);
                        Swal.fire({
                            icon: 'error',
                            title: 'خطأ في تسجيل الخروج',
                            text: 'حدث خطأ أثناء محاولة تسجيل الخروج. يرجى المحاولة مرة أخرى.',
                        });
                    }
                } catch (error) {
                    console.error('Logout - Unexpected error:', error);
                    Swal.fire({
                        icon: 'error',
                        title: 'حدث خطأ غير متوقع',
                        text: 'حدث خطأ غير متوقع. يرجى المحاولة مرة أخرى.',
                    });
                }
            });

            document.getElementById('cancelLogout').addEventListener('click', function() {
                confirmationModal.style.display = 'none';
            });
        });
    } else {
        loginButton.addEventListener('click', function() {
            window.location.href = 'login.html';
        });
    }
});
    </script>
  

    

  <script src="./js/auth.js"></script>
    
    <script src="./js/bootstrap.bundle.min.js"></script>
    <script src="./js/js.js"></script>
   
</body>
</html>